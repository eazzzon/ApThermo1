<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pyAp - Calculating apatite-melt exchange coefficients (Kd) and melt water concentration &mdash; pyAp 1.0 documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pyAp - ternary plot of apatite" href="plot_ternary_test_stoichiometry.html" />
    <link rel="prev" title="Tutorial" href="tutorials.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> pyAp
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About pyAp</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">pyAp - Calculating apatite-melt exchange coefficients (Kd) and melt water concentration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#1.-Import-modules">1. Import modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#2.-Import-data-from-the-directory-where-the-input-data-xlsx-file-is.-The-path-identification-method-below-works-for-mac,-linux,-windows.">2. Import data from the directory where the input data xlsx file is. The path identification method below works for mac, linux, windows.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#3.-calculate-H2O-in-the-melt-from-F-and-Cl-in-the-apatite">3. calculate H2O in the melt from F and Cl in the apatite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#save-results">save results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#4.-Error-integration-from-monte-carlo-simulation-(MCS)">4. Error integration from monte carlo simulation (MCS)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plot_ternary_test_stoichiometry.html">pyAp - ternary plot of apatite</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contrib.html">Contribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyAp</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="tutorials.html">Tutorial</a> &raquo;</li>
      <li>pyAp - Calculating apatite-melt exchange coefficients (Kd) and melt water concentration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/calc_water.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="pyAp---Calculating-apatite-melt-exchange-coefficients-(Kd)-and-melt-water-concentration">
<h1>pyAp - Calculating apatite-melt exchange coefficients (Kd) and melt water concentration<a class="headerlink" href="#pyAp---Calculating-apatite-melt-exchange-coefficients-(Kd)-and-melt-water-concentration" title="Permalink to this headline">¶</a></h1>
<p>pyAp includes the melt hygrometry model (ApThermo) of Li and Costa (2020, GCA) with equations provided in <code class="docutils literal notranslate"><span class="pre">pyApThermo.py</span></code>.</p>
<p>Applying this model requires known F, Cl (and H2O) concentrations in apatite, and the F and Cl concentration in the melt (in equilibrium with apatite).</p>
<p>This example file includes error estimation for the calculated water estimates using a monte carlo simuation algorithm, which is not available in our ApThermo webpage or excel versions.</p>
<p>Please cite Li and Costa (2020) if you use this model:</p>
<p>Li, W. &amp; Costa, F. (2020) A thermodynamic model for F-Cl-OH partitioning between apatite and melt including non-ideal mixing and applications to constraining melt volatile budgets, Geochimica et Cosmochimica Acta 269, 203–222. <a class="reference external" href="https://doi.org/10.1016/j.gca.2019.10.035">https://doi.org/10.1016/j.gca.2019.10.035</a></p>
<div class="section" id="1.-Import-modules">
<h2>1. Import modules<a class="headerlink" href="#1.-Import-modules" title="Permalink to this headline">¶</a></h2>
<p>import releavant modules.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="c1"># hack to allow scripts to be placed in subdirectories next to pyAp:</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;pyAp&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;../pyAp&#39;</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span><span class="o">,</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span><span class="o">,</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">warnings</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import pyAp modules</span>
<span class="kn">from</span> <span class="nn">pyAp</span> <span class="kn">import</span> <span class="n">pyApthermo</span>
<span class="kn">from</span> <span class="nn">pyAp.pyAp_tools</span> <span class="kn">import</span> <span class="n">ap_mc</span><span class="p">,</span> <span class="n">load_animation</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="2.-Import-data-from-the-directory-where-the-input-data-xlsx-file-is.-The-path-identification-method-below-works-for-mac,-linux,-windows.">
<h2>2. Import data from the directory where the input data xlsx file is. The path identification method below works for mac, linux, windows.<a class="headerlink" href="#2.-Import-data-from-the-directory-where-the-input-data-xlsx-file-is.-The-path-identification-method-below-works-for-mac,-linux,-windows." title="Permalink to this headline">¶</a></h2>
<p>!! Do NOT change the column header names in the template provided in the “input” folder.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;/input/4ApThermo/&#39;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">folder</span> <span class="o">/</span> <span class="s1">&#39;calc_water.xlsx&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>extract parameters from the input data file by reading columm header names</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">order</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;XF&#39;</span><span class="p">,</span> <span class="s1">&#39;XCL&#39;</span><span class="p">,</span> <span class="s1">&#39;T,C&#39;</span><span class="p">,</span> <span class="s1">&#39;MELTF&#39;</span><span class="p">,</span> <span class="s1">&#39;MELTCL&#39;</span><span class="p">,</span> <span class="s1">&#39;MELTCOMP&#39;</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="3.-calculate-H2O-in-the-melt-from-F-and-Cl-in-the-apatite">
<h2>3. calculate H2O in the melt from F and Cl in the apatite<a class="headerlink" href="#3.-calculate-H2O-in-the-melt-from-F-and-Cl-in-the-apatite" title="Permalink to this headline">¶</a></h2>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">apply()</span></code> function shown below for calculation using parameters in each row in the input DataFrame.</p>
<p>To perform the calculation, we pass input data into the <code class="docutils literal notranslate"><span class="pre">Apthermo</span></code> class in <code class="docutils literal notranslate"><span class="pre">pyApthermo.py</span></code> (in pyAp folder).</p>
<p>The water speciation model used in calculation is chosen from the available models according to the melt composition (“MELTCOMPF”) provided by users.</p>
<p>The available water speciation models we have compiled are available in “pyAp/water_speciation.csv” and also implemented in <code class="docutils literal notranslate"><span class="pre">pyApThermo.py</span></code>.</p>
<p>If you would like to use another water speciation model, please contact us.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span><span class="o">+</span><span class="s1">&#39;/pyAp/&#39;</span><span class="p">)</span>
<span class="n">wat_spe_m</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span> <span class="o">/</span> <span class="s1">&#39;water_speciation.csv&#39;</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<p>Note the melt compositions you put in your input data file for each crystal have to one of the names listed in the “MeltComp” column below. Otherwise, the calculation will take the default model for “dacite” of Liu et al 2004.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wat_spe_m</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Ref</th>
      <th>MeltComp</th>
      <th>Pressure, GPa</th>
      <th>Temperature, c</th>
      <th>MeltH2O(WT)</th>
      <th>a</th>
      <th>b</th>
      <th>(Eq. k2 = exp(a + b/T), T in K</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Liu et al 2004</td>
      <td>dacite</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.5-2.5</td>
      <td>1.490</td>
      <td>-2634.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Lasne et al 2010</td>
      <td>alkali basalt</td>
      <td>NaN</td>
      <td>1200</td>
      <td>01-Jul</td>
      <td>0.641</td>
      <td>-2704.4</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Zhang et al 1997</td>
      <td>rhyolite</td>
      <td>NaN</td>
      <td>400-600</td>
      <td>≤2.4</td>
      <td>1.876</td>
      <td>-3100.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Hui et al 2008</td>
      <td>rhyolite_highP</td>
      <td>1.0</td>
      <td>350-750</td>
      <td>NaN</td>
      <td>1.804</td>
      <td>-3090.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Ni et al 2009</td>
      <td>andesite</td>
      <td>0.1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.547</td>
      <td>-2453.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Botcharnikov 2006</td>
      <td>andesite_highT</td>
      <td>NaN</td>
      <td>1100-1300</td>
      <td>NaN</td>
      <td>2.990</td>
      <td>-3650.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Switch cal_H2O to True if you would like to calculate melt water contents (default is False). This would pass through <code class="docutils literal notranslate"><span class="pre">meltH2O()</span></code> and return 8 results (following the order below): MeltWater calculated from F and Cl, Kds for OH-Cl, OH-F, Cl-F, and activitivy coefficient (gamma) of OH, F, and Cl.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## create a datafraje for saving results later</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;MeltWater_F&#39;</span><span class="p">,</span> <span class="s1">&#39;MeltWater_Cl&#39;</span><span class="p">,</span><span class="s1">&#39;Kd_OHCl&#39;</span><span class="p">,</span> <span class="s1">&#39;Kd_OHF&#39;</span><span class="p">,</span> <span class="s1">&#39;Kd_ClF&#39;</span><span class="p">,</span> <span class="s1">&#39;gammaOH&#39;</span><span class="p">,</span> <span class="s1">&#39;gammaF&#39;</span><span class="p">,</span> <span class="s1">&#39;gammaCl&#39;</span><span class="p">,</span><span class="s1">&#39;sample&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># default: calculate Kd only</span>
<span class="n">list_kd_result</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">pyApthermo</span><span class="o">.</span><span class="n">ApThermo</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="n">order</span><span class="p">])</span><span class="o">.</span><span class="n">Kd</span><span class="p">(),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># user defined (example)</span>
<span class="n">list_result</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">pyApthermo</span><span class="o">.</span><span class="n">ApThermo</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="n">order</span><span class="p">],</span><span class="n">cal_H2O</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">cal_gamma</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">meltH2O</span><span class="p">(),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">results</span><span class="p">[</span><span class="s1">&#39;MeltWater_F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_result</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;MeltWater_Cl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_result</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;Kd_OHCl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_result</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;Kd_OHF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_result</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;Kd_ClF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_result</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;gammaOH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_result</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;gammaF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_result</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;gammaCl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list_result</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span>

<span class="n">results</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sample</th>
      <th>Kd_ClF</th>
      <th>MeltWater_Cl</th>
      <th>MeltWater_F</th>
      <th>Kd_OHF</th>
      <th>gammaF</th>
      <th>gammaOH</th>
      <th>gammaCl</th>
      <th>Kd_OHCl</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Ap1</td>
      <td>0.117668</td>
      <td>2.288177</td>
      <td>2.454759</td>
      <td>0.010156</td>
      <td>1.139724</td>
      <td>1.257495</td>
      <td>2.359545</td>
      <td>0.086309</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Ap2</td>
      <td>0.111074</td>
      <td>0.987179</td>
      <td>0.943227</td>
      <td>0.012871</td>
      <td>1.078508</td>
      <td>1.352988</td>
      <td>2.572134</td>
      <td>0.115878</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Ap3</td>
      <td>0.062026</td>
      <td>1.145976</td>
      <td>1.872257</td>
      <td>0.003258</td>
      <td>1.044885</td>
      <td>1.569649</td>
      <td>3.393650</td>
      <td>0.052530</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="save-results">
<h2>save results<a class="headerlink" href="#save-results" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;water_estimates_no_error.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="4.-Error-integration-from-monte-carlo-simulation-(MCS)">
<h2>4. Error integration from monte carlo simulation (MCS)<a class="headerlink" href="#4.-Error-integration-from-monte-carlo-simulation-(MCS)" title="Permalink to this headline">¶</a></h2>
<p>Below we give an example for MCS to integrate analytical errors from melt compositions, apatite composition, and temperature.</p>
<p>First, set the entry of MCS (number of runs); better to be larger than 1000.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mc</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
<p>Create dataframe for collecting MCS results and extract raw data and their errors</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ap_mc_collect</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([])</span>
<span class="n">comp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;XF&#39;</span><span class="p">,</span> <span class="s1">&#39;XCL&#39;</span><span class="p">,</span> <span class="s1">&#39;T,C&#39;</span><span class="p">,</span> <span class="s1">&#39;MELTF&#39;</span><span class="p">,</span> <span class="s1">&#39;MELTCL&#39;</span><span class="p">]]</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;XF_SD&#39;</span><span class="p">,</span> <span class="s1">&#39;XCL_SD&#39;</span><span class="p">,</span> <span class="s1">&#39;T_SD&#39;</span><span class="p">,</span><span class="s1">&#39;MELTF_SD&#39;</span><span class="p">,</span> <span class="s1">&#39;MELTCL_SD&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<p>MCS can be perfromed via a loop but that can be rather slow if the dataset is large.</p>
<p>Here we use a built-in function <code class="docutils literal notranslate"><span class="pre">ap_mc()</span></code> to vectorize and expand the existing empty dataframe (“ap_mc_collect”) with MCS results.</p>
<p>Feel free to use your own MCS algorithm if you want.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
    <span class="n">df_iter</span> <span class="o">=</span> <span class="n">ap_mc</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mc</span><span class="p">)</span>
    <span class="n">ap_mc_collect</span> <span class="o">=</span> <span class="n">ap_mc_collect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_iter</span><span class="p">)</span>

<span class="n">ap_mc_collect</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">columns</span>
<span class="n">ap_mc_collect</span><span class="p">[</span><span class="s1">&#39;MELTCOMP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mc</span><span class="p">)][</span><span class="s1">&#39;MELTCOMP&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Apply the <code class="docutils literal notranslate"><span class="pre">meltH2O()</span></code> function to the expanded MCS dataframe. The melt water estimates are saved in the “ap_mc_collect” dataframe.</p>
<p>Note that when MCS has a larger value, a runtime warning might appear.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ap_mc_collect</span><span class="p">[</span><span class="s1">&#39;zz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ap_mc_collect</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">pyApthermo</span><span class="o">.</span><span class="n">ApThermo</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">cal_H2O</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">cal_gamma</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">meltH2O</span><span class="p">(),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ap_mc_collect</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">mc</span><span class="p">)][</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span>

<span class="n">results_mc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MeltWater_F&#39;</span><span class="p">,</span><span class="s1">&#39;MeltWater_Cl&#39;</span><span class="p">])</span>
<span class="n">results_mc</span><span class="p">[</span><span class="s1">&#39;MeltWater_F&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ap_mc_collect</span><span class="p">[</span><span class="s1">&#39;zz&#39;</span><span class="p">]]</span>
<span class="n">results_mc</span><span class="p">[</span><span class="s1">&#39;MeltWater_Cl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ap_mc_collect</span><span class="p">[</span><span class="s1">&#39;zz&#39;</span><span class="p">]]</span>

<span class="n">results_mc</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ap_mc_collect</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/easonzz/miniforge3/lib/python3.9/site-packages/scipy/optimize/minpack.py:175: RuntimeWarning: The iteration is not making good progress, as measured by the
  improvement from the last ten iterations.
  warnings.warn(msg, RuntimeWarning)
/Users/easonzz/miniforge3/lib/python3.9/site-packages/scipy/optimize/minpack.py:175: RuntimeWarning: The iteration is not making good progress, as measured by the
  improvement from the last five Jacobian evaluations.
  warnings.warn(msg, RuntimeWarning)
</pre></div></div>
</div>
<p>Display MCS results for each crystal</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_mc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="8" halign="left">MeltWater_F</th>
      <th colspan="8" halign="left">MeltWater_Cl</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>sample</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Ap1</th>
      <td>1000.0</td>
      <td>2.632001</td>
      <td>1.103110</td>
      <td>6.661436e-01</td>
      <td>1.845204</td>
      <td>2.445361</td>
      <td>3.179341</td>
      <td>8.676760</td>
      <td>1000.0</td>
      <td>2.554121</td>
      <td>1.322317</td>
      <td>5.381545e-01</td>
      <td>1.647385</td>
      <td>2.277966</td>
      <td>3.106162</td>
      <td>11.479575</td>
    </tr>
    <tr>
      <th>Ap2</th>
      <td>1000.0</td>
      <td>0.985690</td>
      <td>0.409133</td>
      <td>5.681841e-16</td>
      <td>0.687214</td>
      <td>0.929801</td>
      <td>1.242427</td>
      <td>2.823094</td>
      <td>1000.0</td>
      <td>1.073669</td>
      <td>0.540902</td>
      <td>5.681841e-16</td>
      <td>0.685099</td>
      <td>0.970699</td>
      <td>1.373093</td>
      <td>4.080361</td>
    </tr>
    <tr>
      <th>Ap3</th>
      <td>1000.0</td>
      <td>2.479382</td>
      <td>2.429334</td>
      <td>-4.291673e-16</td>
      <td>0.923830</td>
      <td>1.910409</td>
      <td>3.158331</td>
      <td>28.383204</td>
      <td>1000.0</td>
      <td>1.556456</td>
      <td>1.574228</td>
      <td>-4.291673e-16</td>
      <td>0.559018</td>
      <td>1.169868</td>
      <td>1.962888</td>
      <td>17.020062</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Calculate the median value for each crystal. If the distribution of MCS results is (nearly) gaussian (see kernel density plot below), a mean value could be used instead of median.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_mc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MeltWater_F</th>
      <th>MeltWater_Cl</th>
    </tr>
    <tr>
      <th>sample</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Ap1</th>
      <td>2.445361</td>
      <td>2.277966</td>
    </tr>
    <tr>
      <th>Ap2</th>
      <td>0.929801</td>
      <td>0.970699</td>
    </tr>
    <tr>
      <th>Ap3</th>
      <td>1.910409</td>
      <td>1.169868</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>plot MCS results</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;MeltWater_F&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">results_mc</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;MeltWater_Cl&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">results_mc</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/calc_water_31_0.png" src="_images/calc_water_31_0.png" />
</div>
</div>
<p>1sd errors in results can be calculated by taking half of the range between 84% and 16% of all MCS results.</p>
<p>melt H2O estimated from Cl in the apatite</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errors</span> <span class="o">=</span> <span class="n">results_mc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">)[</span><span class="s1">&#39;MeltWater_Cl&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">84</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">results_mc</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">results_mc</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]))</span><span class="o">&lt;</span><span class="mi">50</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">results_mc</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span><span class="n">errors</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[1.07184908 0.49579611 1.13009846]
</pre></div></div>
</div>
<p>melt H2O calculated from F in apatite</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">errors</span> <span class="o">=</span> <span class="n">results_mc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">)[</span><span class="s1">&#39;MeltWater_F&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">84</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">results_mc</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">results_mc</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]))</span><span class="o">&lt;</span><span class="mi">50</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">results_mc</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">],</span><span class="n">errors</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0.97121202 0.39684486 1.78556349]
</pre></div></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorials.html" class="btn btn-neutral float-left" title="Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plot_ternary_test_stoichiometry.html" class="btn btn-neutral float-right" title="pyAp - ternary plot of apatite" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Weiran (Alex) Li, Yishen (Eason) Zhang.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>